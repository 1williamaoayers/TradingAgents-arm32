#!/bin/bash

# TradingAgents-CN ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¸¯è‚¡ç‰ˆ - å®‰å…¨ç«¯å£ï¼‰
# ä½œè€…: AIåŠ©æ‰‹
# åŠŸèƒ½: åœ¨VPSä¸Šä¸€é”®éƒ¨ç½²TradingAgents-CNé¡¹ç›®
# é’ˆå¯¹æ¸¯è‚¡äº¤æ˜“æ—¶é—´ä¼˜åŒ–ï¼ŒæŒ‰çœŸå®žè´¢æŠ¥å‘å¸ƒæ—¶é—´å®‰æŽ’æ•°æ®åŒæ­¥
# åªæš´éœ²Webç•Œé¢ç«¯å£ï¼Œå†…éƒ¨æœåŠ¡é€šè¿‡å®¹å™¨ç½‘ç»œé€šä¿¡ï¼Œæé«˜å®‰å…¨æ€§

# è®¾ç½®é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}å¼€å§‹éƒ¨ç½² TradingAgents-CNï¼ˆæ¸¯è‚¡ç‰ˆ - å®‰å…¨ç«¯å£ï¼‰${NC}"

# åˆ›å»ºé¡¹ç›®ç›®å½•
PROJECT_DIR="/home/tradingagents-cn"
mkdir -p $PROJECT_DIR
cd $PROJECT_DIR

echo -e "${YELLOW}åˆ›å»ºé¡¹ç›®ç›®å½•: $PROJECT_DIR${NC}"

# åˆ›å»º .env é…ç½®æ–‡ä»¶
cat > .env << 'EOF'
# TradingAgents-CN DockerçŽ¯å¢ƒé…ç½®
# æ­¤æ–‡ä»¶ä¸“é—¨ç”¨äºŽDockerå®¹å™¨å†…çš„çŽ¯å¢ƒå˜é‡é…ç½®
# é‡è¦ï¼šAPIå¯†é’¥å·²åœ¨æ­¤é…ç½®

# ===== DockerçŽ¯å¢ƒæ ‡è¯† =====
DOCKER_CONTAINER=true

# ===== å¿…éœ€çš„APIå¯†é’¥ =====

# ðŸ‡¨ðŸ‡³ é˜¿é‡Œç™¾ç‚¼ API å¯†é’¥ (æŽ¨èï¼Œå›½äº§å¤§æ¨¡åž‹ï¼Œä¸­æ–‡ä¼˜åŒ–)
# å·²åœ¨æ­¤é…ç½®: sk-68ed54c06e434c108ee93cc6e482bb61
DASHSCOPE_API_KEY=sk-68ed54c06e434c108ee93cc6e482bb61
DASHSCOPE_ENABLED=true

# ðŸ¤– DeepSeek API å¯†é’¥ (æŽ¨èï¼Œæ€§ä»·æ¯”é«˜)
# å·²åœ¨æ­¤é…ç½®: sk-a1c794ab1969492aa06f7d1177af0451
DEEPSEEK_API_KEY=sk-a1c794ab1969492aa06f7d1177af0451
DEEPSEEK_BASE_URL=https://api.deepseek.com
DEEPSEEK_ENABLED=true

# ðŸ“Š FinnHub API å¯†é’¥ (å¿…éœ€ï¼Œç”¨äºŽèŽ·å–é‡‘èžæ•°æ®)
# å·²åœ¨æ­¤é…ç½®: d3vh001r01qt2ctpo400d3vh001r01qt2ctpo40g
FINNHUB_API_KEY=d3vh001r01qt2ctpo400d3vh001r01qt2ctpo40g

# ðŸŒ OpenAI API å¯†é’¥ (å¯é€‰ï¼Œéœ€è¦å›½å¤–ç½‘ç»œ)
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_ENABLED=false

# ðŸ§  æ–‡å¿ƒä¸€è¨€ï¼ˆç™¾åº¦åƒå¸†ï¼‰API å¯†é’¥
QIANFAN_API_KEY=your_qianfan_api_key_here
QIANFAN_ENABLED=false

# ðŸ” Google AI API å¯†é’¥ (å¯é€‰ï¼Œç”¨äºŽGeminiæ¨¡åž‹)
GOOGLE_API_KEY=your_google_api_key_here
GOOGLE_ENABLED=false

# ðŸ¤– Anthropic API å¯†é’¥ (å¯é€‰ï¼Œç”¨äºŽClaudeæ¨¡åž‹)
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_ENABLED=false

# ðŸŒ OpenRouter API å¯†é’¥ (å¯é€‰ï¼Œèšåˆå¤šä¸ªAIæ¨¡åž‹)
OPENROUTER_API_KEY=your_openrouter_api_key_here
OPENROUTER_ENABLED=false

# ðŸ¤– AI302 API å¯†é’¥ (å¯é€‰)
AI302_API_KEY=your_ai302_api_key_here
AI302_ENABLED=false

# ðŸ‡¨ðŸ‡³ ç¡…åŸºæµåŠ¨ API å¯†é’¥ï¼ˆå¯é€‰ï¼‰
SILICONFLOW_API_KEY=your_siliconflow_api_key_here

# ðŸ”§ One API / New APIï¼ˆå¯é€‰ï¼Œè‡ªéƒ¨ç½²èšåˆå¹³å°ï¼‰
ONEAPI_API_KEY=your_oneapi_api_key_here
ONEAPI_BASE_URL=http://localhost:3000/v1

# é€šç”¨OpenAIå…¼å®¹æä¾›å•† API å¯†é’¥ (ç”¨äºŽè‡ªå®šä¹‰ç«¯ç‚¹)
CUSTOM_OPENAI_API_KEY=your-custom-openai-api-key

# ðŸ“ˆ Tushare API Tokenï¼ˆæŽ¨èï¼Œä¸“ä¸šAè‚¡æ•°æ®ï¼‰- æœ¬éƒ¨ç½²å·²ç¦ç”¨
TUSHARE_TOKEN=your_tushare_token_here
TUSHARE_ENABLED=false

# ===== ä»£ç†é…ç½® =====
# é…ç½®éœ€è¦ç»•è¿‡ä»£ç†çš„åŸŸåï¼ˆå›½å†…æ•°æ®æºï¼‰
NO_PROXY=localhost,127.0.0.1,eastmoney.com,push2.eastmoney.com,82.push2.eastmoney.com,82.push2delay.eastmoney.com,gtimg.cn,sinaimg.cn,api.tushare.pro,baostock.com

# ===== æ•°æ®æºé…ç½® =====

# ðŸŽ¯ é»˜è®¤ä¸­å›½è‚¡ç¥¨æ•°æ®æº - è®¾ç½®ä¸ºAKShare
DEFAULT_CHINA_DATA_SOURCE=akshare

# Tushareæƒé™ç­‰çº§é…ç½®ï¼ˆç”¨äºŽé€ŸçŽ‡é™åˆ¶ï¼‰
TUSHARE_TIER=standard
TUSHARE_RATE_LIMIT_SAFETY_MARGIN=0.8

# ===== åœ¨çº¿å·¥å…·é…ç½® =====
ONLINE_TOOLS_ENABLED=false
ONLINE_NEWS_ENABLED=true
REALTIME_DATA_ENABLED=true

# ===== Reddit API é…ç½® (å¯é€‰) =====
REDDIT_CLIENT_ID=your_reddit_client_id_here
REDDIT_CLIENT_SECRET=your_reddit_client_secret_here
REDDIT_USER_AGENT=TradingAgents-CN/1.0

# ===== æ•°æ®åº“é…ç½® =====

# ðŸ”§ æ•°æ®åº“å¯ç”¨å¼€å…³ - æœ¬éƒ¨ç½²å·²å¯ç”¨
MONGODB_ENABLED=true
REDIS_ENABLED=true

# MongoDBé…ç½®ï¼ˆDockerçŽ¯å¢ƒä½¿ç”¨æœåŠ¡åï¼Œå¸¦è®¤è¯ï¼‰
MONGODB_HOST=mongodb
MONGODB_PORT=27017
MONGODB_USERNAME=admin
MONGODB_PASSWORD=tradingagents123
MONGODB_DATABASE=tradingagents
MONGODB_AUTH_SOURCE=admin
MONGODB_URL=mongodb://admin:tradingagents123@mongodb:27017/tradingagents?authSource=admin
MONGO_URI=mongodb://admin:tradingagents123@mongodb:27017/tradingagents?authSource=admin
MONGO_DB=tradingagents
MONGODB_CONNECTION_STRING=mongodb://admin:tradingagents123@mongodb:27017/tradingagents?authSource=admin
MONGODB_DATABASE_NAME=tradingagents
USE_MONGODB_STORAGE=true

# Redisé…ç½®ï¼ˆDockerçŽ¯å¢ƒä½¿ç”¨æœåŠ¡åï¼Œå¸¦å¯†ç ï¼‰
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=tradingagents123
REDIS_DB=0
REDIS_URL=redis://:tradingagents123@redis:6379/0
REDIS_MAX_CONNECTIONS=50
REDIS_RETRY_ON_TIMEOUT=true

# MongoDBè¿žæŽ¥æ± é…ç½®
MONGO_MAX_CONNECTIONS=100
MONGO_MIN_CONNECTIONS=10
# MongoDBè¶…æ—¶å‚æ•°ï¼ˆæ¯«ç§’ï¼‰- ç”¨äºŽå¤„ç†å¤§é‡åŽ†å²æ•°æ®
MONGO_CONNECT_TIMEOUT_MS=30000
MONGO_SOCKET_TIMEOUT_MS=60000
MONGO_SERVER_SELECTION_TIMEOUT_MS=5000

# ===== å®‰å…¨é…ç½® =====

# ðŸ” JWTé…ç½® (ç”¨äºŽç”¨æˆ·è®¤è¯)
JWT_SECRET=docker-jwt-secret-key-change-in-production-2024
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=480
REFRESH_TOKEN_EXPIRE_DAYS=30

# CSRFä¿æŠ¤
CSRF_SECRET=docker-csrf-secret-key-change-in-production-2024
BCRYPT_ROUNDS=12

# ===== APIæœåŠ¡é…ç½® =====

# ðŸš€ APIæœåŠ¡åŸºç¡€é…ç½®
HOST=0.0.0.0
PORT=8000
DEBUG=false

# åŽ†å²å…¼å®¹é…ç½®ï¼ˆå·²åºŸå¼ƒï¼Œä½†ä¿ç•™å…¼å®¹æ€§ï¼‰
API_HOST=0.0.0.0
API_PORT=8000
API_DEBUG=false

# ðŸ”— CORSé…ç½®
ALLOWED_ORIGINS=["http://localhost:3000", "http://localhost:80", "http://localhost:8000"]
ALLOWED_HOSTS=["*"]
CORS_ORIGINS=*

# ðŸ“Š é˜Ÿåˆ—å’Œå¹¶å‘é…ç½®
QUEUE_MAX_SIZE=10000
QUEUE_VISIBILITY_TIMEOUT=300
QUEUE_MAX_RETRIES=3

# å¹¶å‘æŽ§åˆ¶
DEFAULT_USER_CONCURRENT_LIMIT=3
GLOBAL_CONCURRENT_LIMIT=50
DEFAULT_DAILY_QUOTA=1000

# Workeré…ç½®
WORKER_HEARTBEAT_INTERVAL=30

# é€ŸçŽ‡é™åˆ¶
RATE_LIMIT_ENABLED=true
DEFAULT_RATE_LIMIT=100

# ðŸ“ æ–‡ä»¶ä¸Šä¼ é…ç½®
MAX_UPLOAD_SIZE=10485760
UPLOAD_DIR=uploads

# ðŸ“Š ç›‘æŽ§é…ç½®
METRICS_ENABLED=true
HEALTH_CHECK_INTERVAL=60

# ===== æ—¥å¿—é…ç½® =====
TRADINGAGENTS_LOG_LEVEL=INFO
TRADINGAGENTS_LOG_DIR=/app/logs
TRADINGAGENTS_LOG_FILE=/app/logs/tradingagents.log
LOG_LEVEL=INFO
LOG_FORMAT="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
LOG_FILE=logs/tradingagents.log

# ===== æ•°æ®ç›®å½•é…ç½® =====
TRADINGAGENTS_DATA_DIR=/app/data
TRADINGAGENTS_CACHE_DIR=/app/data/cache
TRADINGAGENTS_SESSIONS_DIR=/app/data/sessions
TRADINGAGENTS_LOGS_DIR=/app/data/logs
TRADINGAGENTS_CONFIG_DIR=/app/data/config
TRADINGAGENTS_TEMP_DIR=/app/data/temp
TRADINGAGENTS_RESULTS_DIR=/app/data/analysis_results

# ===== Pythoné…ç½® =====
# ç¦ç”¨Pythonå­—èŠ‚ç ç”Ÿæˆ (å¯é€‰ï¼Œç”¨äºŽå¼€å‘çŽ¯å¢ƒ)
PYTHONDONTWRITEBYTECODE=1

# ===== å†…å­˜å’Œç¼“å­˜é…ç½® =====
# ðŸ§  å†…å­˜åŠŸèƒ½å¯ç”¨å¼€å…³ (é»˜è®¤å¯ç”¨)
MEMORY_ENABLED=true

# ===== ä½¿ç”¨ç»Ÿè®¡å’Œæˆæœ¬è·Ÿè¸ªé…ç½® =====
# ðŸ”§ Tokenä½¿ç”¨ç»Ÿè®¡å¯ç”¨å¼€å…³ (é»˜è®¤å¯ç”¨)
ENABLE_COST_TRACKING=true

# ðŸ’° æˆæœ¬è­¦å‘Šé˜ˆå€¼ (äººæ°‘å¸ï¼Œé»˜è®¤100å…ƒ)
COST_ALERT_THRESHOLD=100.0

# ðŸ“Š æœ€å¤§ä½¿ç”¨è®°å½•æ•°é‡ (é»˜è®¤10000æ¡)
MAX_USAGE_RECORDS=10000

# ===== æ—¶åŒºé…ç½® =====
TZ=Asia/Shanghai
TIMEZONE=Asia/Shanghai

# ===== ç¼“å­˜é…ç½® =====
TA_USE_APP_CACHE=true
CACHE_TTL=3600
SCREENING_CACHE_TTL=1800
SESSION_EXPIRE_HOURS=24

# ===== è‚¡ç¥¨åŸºç¡€ä¿¡æ¯åŒæ­¥è°ƒåº¦é…ç½® =====
SYNC_STOCK_BASICS_ENABLED=true
SYNC_STOCK_BASICS_TIME=06:30

# ===== å®žæ—¶è¡Œæƒ…å…¥åº“ä»»åŠ¡é…ç½® =====
# æ¸¯è‚¡äº¤æ˜“æ—¶é—´ï¼š09:30-12:00, 13:00-16:00
# æ¯4å°æ—¶æ›´æ–°ä¸€æ¬¡ï¼ˆé™ä½Žè¯·æ±‚é¢‘çŽ‡ï¼Œé¿å…è¢«å°ï¼‰
QUOTES_INGEST_ENABLED=true
QUOTES_INGEST_INTERVAL_SECONDS=14400

# å¯ç”¨æŽ¥å£è½®æ¢æœºåˆ¶
QUOTES_ROTATION_ENABLED=true

# Tushare rt_k æŽ¥å£æ¯å°æ—¶è°ƒç”¨æ¬¡æ•°é™åˆ¶
QUOTES_TUSHARE_HOURLY_LIMIT=2

# è‡ªåŠ¨æ£€æµ‹ Tushare rt_k æŽ¥å£æƒé™
QUOTES_AUTO_DETECT_TUSHARE_PERMISSION=true

# ä¼‘å¸‚æœŸ/å¯åŠ¨å…œåº•è¡¥æ•°ï¼ˆå¡«å……ä¸Šä¸€ç¬”æ”¶ç›˜å¿«ç…§ï¼‰
QUOTES_BACKFILL_ON_STARTUP=true
QUOTES_BACKFILL_ON_OFFHOURS=true

# ===== Tushareæ•°æ®åŒæ­¥æœåŠ¡é…ç½® =====
# Tushareç»Ÿä¸€æ•°æ®åŒæ­¥æ€»å¼€å…³ - å·²ç¦ç”¨
TUSHARE_UNIFIED_ENABLED=false
TUSHARE_BASIC_INFO_SYNC_ENABLED=false
TUSHARE_BASIC_INFO_SYNC_CRON=0 2 * * *
TUSHARE_QUOTES_SYNC_ENABLED=false
TUSHARE_QUOTES_SYNC_CRON=*/1 9-15 * * 1-5
TUSHARE_HISTORICAL_SYNC_ENABLED=false
TUSHARE_HISTORICAL_SYNC_CRON=0 16 * * 1-5
TUSHARE_FINANCIAL_SYNC_ENABLED=false
TUSHARE_FINANCIAL_SYNC_CRON=0 3 * * 0
TUSHARE_STATUS_CHECK_ENABLED=false
TUSHARE_STATUS_CHECK_CRON=0 * * * *

# ðŸš€ Tushareæ•°æ®åˆå§‹åŒ–é…ç½®
TUSHARE_INIT_HISTORICAL_DAYS=365
TUSHARE_INIT_BATCH_SIZE=100
TUSHARE_INIT_AUTO_START=false

# ===== AKShareæ•°æ®åŒæ­¥æœåŠ¡é…ç½® =====
# AKShareç»Ÿä¸€æ•°æ®åŒæ­¥æ€»å¼€å…³ - å·²å¯ç”¨
AKSHARE_UNIFIED_ENABLED=true
# åŸºç¡€ä¿¡æ¯åŒæ­¥ - æ¯å¤©å‡Œæ™¨3ç‚¹æ›´æ–°ï¼ˆä¼‘å¸‚æ—¶é—´ï¼‰
AKSHARE_BASIC_INFO_SYNC_ENABLED=true
AKSHARE_BASIC_INFO_SYNC_CRON=0 3 * * *
# æ¸¯è‚¡è¡Œæƒ…åŒæ­¥ï¼ˆäº¤æ˜“æ—¶é—´æ¯4å°æ—¶æ›´æ–°ä¸€æ¬¡ï¼Œé¿å¼€é«˜å³°ï¼‰
# æ¸¯è‚¡äº¤æ˜“æ—¶é—´ï¼š09:30-12:00, 13:00-16:00
# å®‰æŽ’åœ¨ 10:00, 14:00 æ›´æ–°ï¼ˆäº¤æ˜“æ—¶é—´å†…çš„ç›¸å¯¹å®‰å…¨æ—¶æ®µï¼‰
AKSHARE_QUOTES_SYNC_ENABLED=true
AKSHARE_QUOTES_SYNC_CRON=0 10,14 * * 1-5
# åŽ†å²æ•°æ®åŒæ­¥ï¼ˆæ”¶ç›˜åŽ17ç‚¹ï¼‰
AKSHARE_HISTORICAL_SYNC_ENABLED=true
AKSHARE_HISTORICAL_SYNC_CRON=0 17 * * 1-5
# è´¢åŠ¡æ•°æ®åŒæ­¥ï¼ˆæŒ‰æ¸¯è‚¡è´¢æŠ¥å‘å¸ƒè§„å¾‹å®‰æŽ’ï¼‰
# ä¸€å­£åº¦æŠ¥ï¼ˆ3-5æœˆï¼‰- æ¯å¹´3-5æœˆæ¯æ—¥å‡Œæ™¨4ç‚¹åŒæ­¥
AKSHARE_Q1_FINANCIAL_SYNC_ENABLED=true
AKSHARE_Q1_FINANCIAL_SYNC_CRON=0 4 * 3-5 *
# åŠå¹´æŠ¥ï¼ˆ8-9æœˆï¼‰- æ¯å¹´8-9æœˆæ¯æ—¥å‡Œæ™¨4ç‚¹åŒæ­¥
AKSHARE_Q2_FINANCIAL_SYNC_ENABLED=true
AKSHARE_Q2_FINANCIAL_SYNC_CRON=0 4 * 8-9 *
# ä¸‰å­£åº¦æŠ¥ï¼ˆ10-11æœˆï¼‰- æ¯å¹´10-11æœˆæ¯æ—¥å‡Œæ™¨4ç‚¹åŒæ­¥
AKSHARE_Q3_FINANCIAL_SYNC_ENABLED=true
AKSHARE_Q3_FINANCIAL_SYNC_CRON=0 4 * 10-11 *
# å¹´æŠ¥ï¼ˆ3-4æœˆï¼‰- æ¯å¹´3-4æœˆæ¯æ—¥å‡Œæ™¨4ç‚¹åŒæ­¥
AKSHARE_ANNUAL_SYNC_ENABLED=true
AKSHARE_ANNUAL_SYNC_CRON=0 4 * 3-4 *
# çŠ¶æ€æ£€æŸ¥ï¼ˆæ¯å°æ—¶30åˆ†ï¼‰
AKSHARE_STATUS_CHECK_ENABLED=true
AKSHARE_STATUS_CHECK_CRON=30 * * * *

# ðŸš€ AKShareæ•°æ®åˆå§‹åŒ–é…ç½®
AKSHARE_INIT_HISTORICAL_DAYS=365
AKSHARE_INIT_BATCH_SIZE=100
AKSHARE_INIT_AUTO_START=true

# ===== åˆ†æžå¸ˆæ•°æ®èŽ·å–é…ç½® =====
# å¸‚åœºåˆ†æžå›žæº¯å¤©æ•°ï¼ˆç”¨äºŽæŠ€æœ¯åˆ†æžï¼‰
MARKET_ANALYST_LOOKBACK_DAYS=365

# ===== BaoStockæ•°æ®åŒæ­¥æœåŠ¡é…ç½® =====
# BaoStockç»Ÿä¸€æ•°æ®åŒæ­¥æ€»å¼€å…³ - å·²ç¦ç”¨ï¼ˆä¸»è¦æœåŠ¡Aè‚¡ï¼‰
BAOSTOCK_UNIFIED_ENABLED=false
BAOSTOCK_BASIC_INFO_SYNC_ENABLED=false
BAOSTOCK_BASIC_INFO_SYNC_CRON=0 4 * * *
BAOSTOCK_DAILY_QUOTES_SYNC_ENABLED=false
BAOSTOCK_DAILY_QUOTES_SYNC_CRON=0 16 * * 1-5
BAOSTOCK_QUOTES_SYNC_ENABLED=false
BAOSTOCK_QUOTES_SYNC_CRON=*/15 9-15 * * 1-5
BAOSTOCK_HISTORICAL_SYNC_ENABLED=false
BAOSTOCK_HISTORICAL_SYNC_CRON=0 18 * * 1-5
BAOSTOCK_STATUS_CHECK_ENABLED=false
BAOSTOCK_STATUS_CHECK_CRON=45 * * * *

# ðŸš€ BaoStockæ•°æ®åˆå§‹åŒ–é…ç½®
BAOSTOCK_INIT_HISTORICAL_DAYS=365
BAOSTOCK_INIT_BATCH_SIZE=50
BAOSTOCK_INIT_AUTO_START=false

# ===== æ–°é—»æ•°æ®åŒæ­¥æœåŠ¡é…ç½® =====
NEWS_SYNC_ENABLED=false
NEWS_SYNC_CRON=0 */2 * * *
NEWS_SYNC_HOURS_BACK=24
NEWS_SYNC_MAX_PER_SOURCE=50

# ===== æ¸¯è‚¡ç‰¹å®šé…ç½® =====
# æ¸¯è‚¡äº¤æ˜“æ—¥é…ç½®ï¼ˆæ¸¯è‚¡ä¸ŽAè‚¡äº¤æ˜“æ—¥åŸºæœ¬ä¸€è‡´ï¼Œä½†éœ€è€ƒè™‘æ—¶å·®å’Œç‰¹æ®Šå®‰æŽ’ï¼‰
HKEX_TRADING_DAYS_ENABLED=true
# æ¸¯è‚¡äº¤æ˜“æ—¶é—´é…ç½®ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
HKEX_OPEN_TIME_AM=09:30
HKEX_CLOSE_TIME_AM=12:00
HKEX_OPEN_TIME_PM=13:00
HKEX_CLOSE_TIME_PM=16:00

# æ¸¯è‚¡æ•°æ®æºä¼˜å…ˆçº§ï¼ˆé’ˆå¯¹æ¸¯è‚¡è‚¡ç¥¨ï¼‰
HKEX_DATA_SOURCE_PRIORITY=["akshare", "finnhub", "yahoo"]

# æ¸¯è‚¡æ•°æ®ç¼“å­˜é…ç½®ï¼ˆæ¸¯è‚¡æ•°æ®æ›´æ–°é¢‘çŽ‡è¾ƒä½Žï¼‰
HKEX_DATA_CACHE_TTL=7200
HKEX_QUOTE_CACHE_TTL=3600

# æ¸¯è‚¡æŒ‡æ•°åŒæ­¥é…ç½®
HKEX_INDEX_SYNC_ENABLED=true
HKEX_INDEX_SYNC_CRON=0 10,14,16 * * 1-5

# æ¸¯è‚¡é€šæ•°æ®åŒæ­¥ï¼ˆå¦‚æžœéœ€è¦ï¼‰
HK_CONNECT_SYNC_ENABLED=false
HK_CONNECT_SYNC_CRON=0 17 * * 1-5

# æ¸¯è‚¡è´¢æŠ¥æ•°æ®åŒæ­¥é…ç½®ï¼ˆæŒ‰æ¸¯è‚¡è´¢æŠ¥æ—¶é—´è¡¨ï¼‰
HKEX_Q1_REPORT_SYNC_MONTHS=3,4,5      # ä¸€å­£åº¦æŠ¥å‘å¸ƒæœˆä»½
HKEX_Q2_REPORT_SYNC_MONTHS=8,9        # åŠå¹´æŠ¥å‘å¸ƒæœˆä»½
HKEX_Q3_REPORT_SYNC_MONTHS=10,11      # ä¸‰å­£åº¦æŠ¥å‘å¸ƒæœˆä»½
HKEX_ANNUAL_REPORT_SYNC_MONTHS=3,4    # å¹´æŠ¥å‘å¸ƒæœˆä»½

# æ¸¯è‚¡èŠ‚å‡æ—¥é…ç½®ï¼ˆé¿å…åœ¨æ¸¯è‚¡ä¼‘å¸‚æ—¥è¿›è¡Œæ•°æ®åŒæ­¥ï¼‰
HKEX_HOLIDAYS=["2024-01-01", "2024-02-10", "2024-02-11", "2024-02-12", "2024-04-10", "2024-05-01", "2024-06-10", "2024-07-01", "2024-09-17", "2024-10-01", "2024-12-25", "2024-12-26"]
EOF

echo -e "${GREEN}.env é…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆï¼ˆæ¸¯è‚¡ç‰ˆï¼‰${NC}"

# åˆ›å»º docker-compose.yml æ–‡ä»¶ï¼ˆåªæš´éœ²Webç•Œé¢ç«¯å£ï¼Œå†…éƒ¨æœåŠ¡æ— ç«¯å£æš´éœ²ï¼‰
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  mongodb:
    image: mongo:5.0
    container_name: tradingagents_mongodb
    restart: unless-stopped
    # ä¸æš´éœ²ç«¯å£ï¼Œä»…å†…éƒ¨é€šä¿¡
    volumes:
      - mongodb_data:/data/db
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=tradingagents123
    networks:
      - tradingagents_network

  redis:
    image: redis:7-alpine
    container_name: tradingagents_redis
    restart: unless-stopped
    # ä¸æš´éœ²ç«¯å£ï¼Œä»…å†…éƒ¨é€šä¿¡
    command: redis-server --requirepass tradingagents123
    volumes:
      - redis_data:/data
    networks:
      - tradingagents_network

  tradingagents:
    image: birdxs/tradingagents-cn:latest
    container_name: tradingagents_app
    restart: unless-stopped
    ports:
      - "8501:8501"  # åªæš´éœ²Webç•Œé¢ç«¯å£
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env
    environment:
      - DOCKER_CONTAINER=true
      - MONGODB_ENABLED=true
      - REDIS_ENABLED=true
      - DEFAULT_CHINA_DATA_SOURCE=akshare
      - AKSHARE_UNIFIED_ENABLED=true
      - TUSHARE_ENABLED=false
      - HKEX_TRADING_DAYS_ENABLED=true
    depends_on:
      - mongodb
      - redis
    networks:
      - tradingagents_network

volumes:
  mongodb_data:
  redis_data:

networks:
  tradingagents_network:
    driver: bridge
EOF

echo -e "${GREEN}docker-compose.yml æ–‡ä»¶åˆ›å»ºå®Œæˆï¼ˆå®‰å…¨ç«¯å£ç‰ˆï¼‰${NC}"

# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > start.sh << 'EOF'
#!/bin/bash

# TradingAgents-CN å¯åŠ¨è„šæœ¬ï¼ˆæ¸¯è‚¡ç‰ˆ - å®‰å…¨ç«¯å£ï¼‰

echo "æ­£åœ¨å¯åŠ¨ TradingAgents-CNï¼ˆæ¸¯è‚¡ç‰ˆ - å®‰å…¨ç«¯å£ï¼‰..."

# æ‹‰å–æœ€æ–°é•œåƒ
echo "æ­£åœ¨æ‹‰å–æœ€æ–°é•œåƒ..."
docker pull birdxs/tradingagents-cn:latest

# å¯åŠ¨æœåŠ¡
echo "æ­£åœ¨å¯åŠ¨æœåŠ¡..."
docker-compose up -d

echo "æœåŠ¡å¯åŠ¨å®Œæˆï¼"
echo "Webç•Œé¢è®¿é—®åœ°å€: http://$(curl -s ifconfig.me):8501"
echo "ç™»å½•è´¦å·: admin"
echo "ç™»å½•å¯†ç : admin123"
echo ""
echo "æŸ¥çœ‹æœåŠ¡çŠ¶æ€: docker-compose ps"
echo "æŸ¥çœ‹æ—¥å¿—: docker-compose logs -f tradingagents"
EOF

chmod +x start.sh

echo -e "${GREEN}å¯åŠ¨è„šæœ¬åˆ›å»ºå®Œæˆ${NC}"

# åˆ›å»ºåœæ­¢è„šæœ¬
cat > stop.sh << 'EOF'
#!/bin/bash

# TradingAgents-CN åœæ­¢è„šæœ¬

echo "æ­£åœ¨åœæ­¢ TradingAgents-CN..."
docker-compose down
echo "æœåŠ¡å·²åœæ­¢"
EOF

chmod +x stop.sh

echo -e "${GREEN}åœæ­¢è„šæœ¬åˆ›å»ºå®Œæˆ${NC}"

# åˆ›å»ºçŠ¶æ€æ£€æŸ¥è„šæœ¬
cat > status.sh << 'EOF'
#!/bin/bash

# TradingAgents-CN çŠ¶æ€æ£€æŸ¥è„šæœ¬

echo "æ­£åœ¨æ£€æŸ¥ TradingAgents-CN æœåŠ¡çŠ¶æ€..."
docker-compose ps
EOF

chmod +x status.sh

echo -e "${GREEN}çŠ¶æ€æ£€æŸ¥è„šæœ¬åˆ›å»ºå®Œæˆ${NC}"

# åˆ›å»ºæ—¥å¿—æŸ¥çœ‹è„šæœ¬
cat > logs.sh << 'EOF'
#!/bin/bash

# TradingAgents-CN æ—¥å¿—æŸ¥çœ‹è„šæœ¬

echo "æ­£åœ¨æŸ¥çœ‹ TradingAgents-CN æ—¥å¿—..."
docker-compose logs -f tradingagents
EOF

chmod +x logs.sh

echo -e "${GREEN}æ—¥å¿—æŸ¥çœ‹è„šæœ¬åˆ›å»ºå®Œæˆ${NC}"

# åˆ›å»ºå®‰å…¨ç«¯å£é…ç½®è¯´æ˜Žè„šæœ¬
cat > security_info.sh << 'EOF'
#!/bin/bash

# TradingAgents-CN å®‰å…¨ç«¯å£é…ç½®è¯´æ˜Ž

echo "TradingAgents-CN å®‰å…¨ç«¯å£é…ç½®è¯´æ˜Ž"
echo "=================================="
echo ""
echo "1. ç«¯å£é…ç½®ç­–ç•¥ï¼š"
echo "   - åªæš´éœ²8501ç«¯å£ï¼ˆWebç•Œé¢ï¼‰ç»™å¤–éƒ¨ç½‘ç»œ"
echo "   - MongoDBå’ŒRedisæœåŠ¡ä¸æš´éœ²ç«¯å£ï¼ˆä»…å†…éƒ¨å®¹å™¨ç½‘ç»œé€šä¿¡ï¼‰"
echo ""
echo "2. æœåŠ¡é—´é€šä¿¡ï¼š"
echo "   - ä¸»åº”ç”¨(tradingagents)é€šè¿‡å®¹å™¨åè¿žæŽ¥mongodbå’Œredis"
echo "   - ä½¿ç”¨å†…éƒ¨ç½‘ç»œtradingagents_networkè¿›è¡Œé€šä¿¡"
echo ""
echo "3. å®‰å…¨ä¼˜åŠ¿ï¼š"
echo "   - å‡å°‘æ”»å‡»é¢ï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§"
echo "   - æ•°æ®åº“å’Œç¼“å­˜æœåŠ¡ä¸ä¼šè¢«å¤–éƒ¨ç›´æŽ¥è®¿é—®"
echo "   - ç¬¦åˆæœ€å°æƒé™åŽŸåˆ™"
echo ""
echo "4. æ¸¯è‚¡ä¼˜åŒ–é…ç½®ï¼š"
echo "   - æ¸¯è‚¡äº¤æ˜“æ—¶é—´ï¼š09:30-12:00, 13:00-16:00"
echo "   - è¡Œæƒ…æ›´æ–°ï¼šæ¯å¤©10:00, 14:00"
echo "   - è´¢æŠ¥åŒæ­¥ï¼šæŒ‰æ¸¯è‚¡è´¢æŠ¥å‘å¸ƒå‘¨æœŸå®‰æŽ’"
echo "   - ä½Žè¯·æ±‚é¢‘çŽ‡ï¼šæ¯4å°æ—¶æ›´æ–°ï¼Œé¿å…è¢«å°æŽ¥å£"
EOF

chmod +x security_info.sh

echo -e "${GREEN}å®‰å…¨ç«¯å£é…ç½®è¯´æ˜Žè„šæœ¬åˆ›å»ºå®Œæˆ${NC}"

# æ‹‰å–é•œåƒ
echo -e "${YELLOW}æ­£åœ¨æ‹‰å– TradingAgents-CN é•œåƒ...${NC}"
docker pull birdxs/tradingagents-cn:latest

# å¯åŠ¨æœåŠ¡
echo -e "${YELLOW}æ­£åœ¨å¯åŠ¨æœåŠ¡...${NC}"
docker-compose up -d

echo -e "${GREEN}éƒ¨ç½²å®Œæˆï¼ï¼ˆæ¸¯è‚¡ç‰ˆ - å®‰å…¨ç«¯å£ï¼‰${NC}"
echo ""
echo -e "${GREEN}è®¿é—®åœ°å€: http://$(curl -s ifconfig.me):8501${NC}"
echo -e "${GREEN}ç™»å½•è´¦å·: admin${NC}"
echo -e "${GREEN}ç™»å½•å¯†ç : admin123${NC}"
echo ""
echo -e "${YELLOW}å¸¸ç”¨å‘½ä»¤:${NC}"
echo -e "${YELLOW}å¯åŠ¨æœåŠ¡: ./start.sh${NC}"
echo -e "${YELLOW}åœæ­¢æœåŠ¡: ./stop.sh${NC}"
echo -e "${YELLOW}æŸ¥çœ‹çŠ¶æ€: ./status.sh${NC}"
echo -e "${YELLOW}æŸ¥çœ‹æ—¥å¿—: ./logs.sh${NC}"
echo -e "${YELLOW}å®‰å…¨é…ç½®è¯´æ˜Ž: ./security_info.sh${NC}"
echo -e "${YELLOW}æ‰‹åŠ¨å¯åŠ¨: docker-compose up -d${NC}"
echo -e "${YELLOW}æ‰‹åŠ¨åœæ­¢: docker-compose down${NC}"
echo ""
echo -e "${GREEN}APIå¯†é’¥å·²é…ç½®:${NC}"
echo -e "${GREEN}- é˜¿é‡Œç™¾ç‚¼ API: sk-68ed54c06e434c108ee93cc6e482bb61${NC}"
echo -e "${GREEN}- DeepSeek V3 API: sk-a1c794ab1969492aa06f7d1177af0451${NC}"
echo -e "${GREEN}- FinnHub API: d3vh001r01qt2ctpo400d3vh001r01qt2ctpo40g${NC}"
echo -e "${GREEN}- æ•°æ®åº“: MongoDB å’Œ Redis å·²å¯ç”¨ï¼ˆå†…éƒ¨é€šä¿¡ï¼‰${NC}"
echo -e "${GREEN}- æ•°æ®æº: AKShare å·²å¯ç”¨ï¼ˆæ¸¯è‚¡ç‰ˆæ—¶é—´å®‰æŽ’ï¼‰${NC}"
echo -e "${GREEN}- Tushare: å·²ç¦ç”¨${NC}"
echo ""
echo -e "${YELLOW}å®‰å…¨ç«¯å£é…ç½®:${NC}"
echo -e "${YELLOW}- åªæš´éœ²8501ç«¯å£ï¼ˆWebç•Œé¢ï¼‰${NC}"
echo -e "${YELLOW}- MongoDBå’ŒRedisæ— å¤–éƒ¨ç«¯å£æš´éœ²${NC}"
echo -e "${YELLOW}- å†…éƒ¨æœåŠ¡é€šè¿‡å®¹å™¨ç½‘ç»œé€šä¿¡${NC}"
echo -e "${YELLOW}- æé«˜å®‰å…¨æ€§ï¼Œå‡å°‘æ”»å‡»é¢${NC}"
EOF

è¿™ä¸ªå®‰å…¨ç«¯å£ç‰ˆè„šæœ¬çš„æ”¹è¿›ï¼š

1. **åªæš´éœ²Webç•Œé¢ç«¯å£**ï¼š
   - åªæœ‰tradingagentsæœåŠ¡æš´éœ²8501ç«¯å£ç»™å¤–éƒ¨ç½‘ç»œ
   - MongoDBå’ŒRedisæœåŠ¡ä¸å†æš´éœ²ç«¯å£ç»™å¤–éƒ¨

2. **å†…éƒ¨æœåŠ¡é€šä¿¡**ï¼š
   - MongoDBå’ŒRedisé€šè¿‡å†…éƒ¨å®¹å™¨ç½‘ç»œä¸Žä¸»åº”ç”¨é€šä¿¡
   - ä½¿ç”¨å®¹å™¨åä½œä¸ºä¸»æœºåè¿žæŽ¥æ•°æ®åº“å’Œç¼“å­˜

3. **å®‰å…¨æ€§æå‡**ï¼š
   - å¤§å¹…å‡å°‘æ”»å‡»é¢
   - æ•°æ®åº“å’Œç¼“å­˜æœåŠ¡ä¸ä¼šè¢«å¤–éƒ¨ç›´æŽ¥è®¿é—®
   - ç¬¦åˆå®‰å…¨æœ€ä½³å®žè·µ

4. **ä¿æŒæ¸¯è‚¡ä¼˜åŒ–é…ç½®**ï¼š
   - æ¸¯è‚¡äº¤æ˜“æ—¶é—´åŒæ­¥å®‰æŽ’
   - æŒ‰çœŸå®žè´¢æŠ¥å‘å¸ƒå‘¨æœŸå®‰æŽ’åŒæ­¥
   - ä½Žè¯·æ±‚é¢‘çŽ‡ç­–ç•¥

è¿™æ ·é…ç½®æ—¢æ»¡è¶³äº†å®žé™…ä½¿ç”¨éœ€æ±‚ï¼Œåˆæœ€å¤§åŒ–åœ°æé«˜äº†ç³»ç»Ÿå®‰å…¨æ€§ã€‚